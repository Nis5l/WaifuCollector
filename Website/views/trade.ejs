<DOCTYPE html>
<html lang="en">
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

        <title>WaifuCollector | Settings</title>

        <link rel="stylesheet" href="resources/css/all.css">

    </head>

    <body id="test">

        <%- include('partials/nav.ejs') %>

        <div class="trade">
			<div id="tradeself">
				<div class="name">You</div>
			<div id="tradeselfinner">
			</div>
			</div>
			<div id="tradeother">
				<div class="name"><%- username %></div>
				<div id="tradeotherinner">
				</div>
			</div>
			<input type="button" class="addtrade" value="Add Card"></input>
        </div>
        <form class="addtradeform" action="/tradeinventory" method="get">
            <input type="hidden" name="userID" value="<%-userID%>"/>
        </form>
    </body>
	
	<script
	src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	crossorigin="anonymous"></script>

	<script>
			 const cards = <%- JSON.stringify(data.selfcards) %>;
			 const cardsother = <%- JSON.stringify(data.friendcards) %>;
			 var opn = document.getElementById('tradeselfinner');
			 var opnother = document.getElementById('tradeotherinner');

			var tofit = [];
			insert(cards, opn);
			insert(cardsother, opnother);
			function insert(_cards, _opn)
			{
				 var off = 0;
				for(var i = 0; i < _cards.length; i++/*,off+=cardSize*/)
				 {
				   var path = _cards[i].cardImage;
				   var posX =  off;
					var cardhtml = `<waifu-card id=card${i} img_path=${path} frame-front=${_cards[i].frame.path_front} frame-back=${_cards[i].frame.path_back} pos-x=${posX} card-name=\"${_cards[i].cardName}\" anime-name=\"${_cards[i].type.name}\" turned=false quality=${_cards[i].quality} level=${_cards[i].level} uuid=${_cards[i].uuid} cardID=${_cards[i].id} card-size=1></waifu-card>`;
				   _opn.insertAdjacentHTML('beforeend',
				   cardhtml);

				   var o = document.getElementById(`card${i}`);
				   tofit.push(o);
				 }
			}
			 
			window.onload = function() {
		           for(var i = 0; i < tofit.length; i++)
		           {
		             	tofit[i].fit();
		           }
		         }
	</script>
	<script>
      $(".addtrade").click(()=>{
        var ele = document.querySelector(".addtradeform");
        ele.submit();
      });
	</script>

	<script>
		var parentself = document.querySelector("#tradeself");
		var inventory = document.querySelector("#tradeselfinner");
		var parentother = document.querySelector("#tradeother");
		var inventoryother = document.querySelector("#tradeotherinner");
		resize(inventory, parentself, cards);
		resize(inventoryother, parentother, cardsother);
		window.onresize = function(event) {
			resize(inventory, parentself, cards);
			resize(inventoryother, parentother, cardsother);
		};
		function resize(inv, parent, c)
		{
			var amount = Math.floor((parent.offsetWidth)/ 273);
			if(amount > c.length)
				amount = c.length;
			if(amount <= 0)
				amount = 1;
			var size = amount * 273;
			inv.style.width = size + "px";
		}
	</script>

	<script src="../resources/components.js"></script>
</html>
