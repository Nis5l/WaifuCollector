<!DOCTYPE html>
<html lang="en">
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

        <title>WaifuCollector | Pack</title>

        <link rel="stylesheet" href="resources/css/all.css">
    </head>
    <body id="body" class="scrollable">

        <%- include('partials/nav.ejs') %>
        
        <form action="/friends" method="get">
            <input type="search" name="search" placeholder=""/>
            <input type="submit" value="Search" name="submit"></input>
        </form>
		<input class="addfriend" type="submit" value="Add Friend" name="submit"></input>

        <form class="addfriendform" action="/addfriend" method="post">
            <input type="hidden" name="username" value=""/>
        </form>

        <div id="friends">
        </div>
        
        <div class="bot"></div>
    </body>

    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>

	<script>
        const friends = <%- JSON.stringify(friends) %>;
		console.log(friends);
		var opn = document.getElementById('friends');
		for(var i = 0; i < friends.length; i++)
		{
			var cardhtml = `<friend-card username=\"${friends[i].username}\" userID=${friends[i].userID} status=${friends[i].status}> </friend-card>`;
            opn.insertAdjacentHTML('beforeend', cardhtml);
		}
	</script>

	<script>
		var opn = document.getElementById('body');
		var form = document.querySelector(".addfriendform");
		$(".addfriend").click(()=>{
			opn.insertAdjacentHTML('afterend',
				`<add-friend> </add-friend>`);
			isOpen = true;
			var conf = document.querySelector("add-friend");
			conf.yesCallback = () => {
				form.username.value = conf.username.value;
				form.submit();
				conf.remove();
				isOpen = false;
			};
			conf.noCallback = () => {conf.remove(); isOpen = false;};
		});
	</script>

	<script>
		var inv = document.querySelector("#friends");
        //const friends = <%- JSON.stringify(friends) %>;
		resize();
		window.onresize = function(event) {
			resize();
		};
		function resize()
		{
			var amount = Math.floor(document.body.offsetWidth / 300);
			if(amount > friends.length)
				amount = friends.length;
			if(amount <= 0)
				amount = 1;
			var size = amount * 300;
			inv.style.width = size + "px";
}
	</script>
	
    <script src="../resources/components.js"></script> 
</html>
