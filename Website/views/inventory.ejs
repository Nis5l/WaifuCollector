<!DOCTYPE html>
<html lang="en">
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

        <title>WaifuCollector | Pack</title>

        <link rel="stylesheet" href="resources/css/all.css">
    </head>
    <body class="scrollable">

        <%- include('partials/nav.ejs') %>
        
        <form action="/inventory" method="get">
            <input type="search" name="search" placeholder=""/>
            <input type="submit" value="Change" name="submit"></input>
        </form>
        <div class="page">
          <input type="button" class="previous" value="<"></input>
            <%- `${page}/${pagemax}` %>
          <input type="button" class="next" value=">"></input>
        </div>

        <form class="nextForm" action="/inventory" method="get">
            <input type="hidden" name="next" value="0"/>
        </form>

        <form class="prevForm" action="/inventory" method="get">
            <input type="hidden" name="next" value="1"/>
        </form>

        <form class="cardForm" action="/card" method="get">
            <input type="hidden" name="uuid" value="1"/>
        </form>

        <div id="inventory">
        </div>
        

        <div class="page">
          <input type="button" class="previous" value="<"></input>
            <%- `${page}/${pagemax}` %>
          <input type="button" class="next" value=">"></input>
        </div>
        <div class="bot"></div>
    </body>

    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>

    <% if (cards != undefined) { %>
        <script>
            const cards = <%- JSON.stringify(cards) %>;
            var opn = document.getElementById('inventory');
            
            var packdiv = opn.insertAdjacentHTML('beforeend', '')
            //var cardSize = 110;
            //var off = 235-(cards.length-1) / 2 * cardSize;
            var off = 10;           
            var tofit = [];
            for(var i = 0; i < cards.length; i++/*,off+=cardSize*/)
            {
              var path = cards[i].card.cardImage;
              var posX =  off;
              var cardhtml = `<waifu-card id=card${i} img_path=${path} frame-front=${cards[i].card.frame.path_front} frame-back=${cards[i].card.frame.path_back} pos-x=${posX} card-name=\"${cards[i].card.cardName}\" anime-name=\"${cards[i].card.type.name}\" turned=false quality=${cards[i].quality} level=${cards[i].level} uuid=${cards[i].id}></waifu-card>`;
              opn.insertAdjacentHTML('beforeend',
              cardhtml);
            
              var o = document.getElementById(`card${i}`);
              tofit.push(o);
            }
            window.onload = function() {
              for(var i = 0; i < tofit.length; i++)
              {
                tofit[i].fit();
              }
            }
        </script>
    <% } %> 


    <script>
        var f = document.querySelector(".cardForm");
         $(document).click(function(event) {
          var ele = $(event.target);
          if(ele.is('waifu-card'))
           f.uuid.value = ele[0].uuid;
           f.submit();
        }); 
    </script>

    
    <script>
      $(".next").click(()=>{
        var ele = document.querySelector(".nextForm");
        ele.submit();
      });

      $(".previous").click(()=>{
        var ele = document.querySelector(".prevForm");
        ele.submit();
      });
      
      $(".next2").click(()=>{
        var ele = document.querySelector(".nextForm");
        ele.submit();
      });

      $(".previous2").click(()=>{
        var ele = document.querySelector(".prevForm");
        ele.submit();
      });
    </script>

    <script src="../resources/components.js"></script> 
</html>
