<!DOCTYPE html>
<html lang="en">

    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

        <title>WaifuCollector | Dashboard</title>

        <link rel="stylesheet" href="resources/css/all.css">
		
    </head>

    <body>

        <%- include('partials/nav.ejs') %>

        <div class="wrapper">

            <hr style="color: rgba(0, 0, 0, 0); border-color:rgba(0, 0, 0, 0); background-color: rgba(0, 0, 0, 0);">

            <div class="dashboard card2">

                <div class="menu">

                    <h2 id="username"><%= username %></h2>

                    <a id="settings" href="/settings"><i class="fas fa-cog fa-2x"></i></a>

                </div>

                <div class="grid_3 stats">

                    <div class="content">

                        <p>Cards unlocked: 16 / 67</p>
                        <p>Friends: 0</p>
                        <p>Friends online: 0</p>

                    </div>

                </div>

                <div class="grid_9 collection">

                    <div class="pack">
                        <progress-ring name="progress" stroke="4" radius="130" progress=<%= 100 - time /  fulltime %>) time=<%=time <= 0 ? 0 : time %>></progress-ring>
                    </div>
                    <div class="inventory">
                    </div>

                </div>

            </div>

        </div>

        <script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>

            <% if (time != undefined && fulltime != undefined) { %>
                <script>
                    const el = document.querySelector('progress-ring');
                    var time = <%= time %>;
                    var fulltime = <%= fulltime %>;

                    const interval = setInterval(() => {
                        time -= 1000;
                        var perc = 100 - (time / fulltime * 100);
                        if(perc > 100)
                        {
                            perc = 100;
                            var timein = 0;
                        }else
                        {
                            var timein = time;
                        }
                        el.setAttribute('progress', perc);
                        el.setAttribute('time', timein);
                        if (perc === 100)
                            clearInterval(interval);
                    }, 1000);
                </script>
            <% } %>

            <script>
                
                window.onmousedown = function(e) {
                    const el = document.querySelector('progress-ring');
                    x = e.pageX;
                    y = e.pageY;
                    if (el.isClicked(x,y)) {
                        var form = document.createElement('form');
                        document.body.appendChild(form);
                        form.method = 'get';
                        form.action = '/pack';
                        form.submit();
                    }
                }
            </script>

            <script>
                //el.setProgress(50);
                
                //const time = this.getAttribute('time');
                //const time = ${time};
                //const fulltime = this.getAttribute('fulltime');

                function sectionHeights() {
                    var height = $('.dashboard').outerHeight() - $('.dashboard .menu').outerHeight() -35;
                    $('.stats, .collection').css('height', height);
                }

                $(document).ready(sectionHeights);

                $(window).on('resize', function(){
                    sectionHeights();
                });

            </script>
            
        <script src="../resources/components.js"></script>

    </body>

</html>