version: "3.5"
services: 
  mysql:
    image: mariadb:latest
    environment:
      MYSQL_DATABASE: waifucollector
      # this mysql database should only be exposed to the other services
      MYSQL_ROOT_PASSWORD: waifu
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./mysql:/var/lib/mysql
    networks:
      - default
    restart: always

  server:
    build: server/
    environment:
      - VIRTUAL_HOST=api.waifucollector.com
      - LETSENCRYPT_HOST=api.waifucollector.com
      - LETSENCRYPT_EMAIL=kirchler.lion@gmail.com
    depends_on:
      - mysql
    networks:
      - default

  client:
    build: client/
    environment:
      - VIRTUAL_HOST=waifucollector.com
      - LETSENCRYPT_HOST=waifucollector.com
      - LETSENCRYPT_EMAIL=kirchler.lion@gmail.com
    depends_on:
      - server
    networks:
      - default

networks:
  default:
    external: true
    name: proxy
